<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>今日のやること</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
    "Hiragino Sans", "Noto Sans JP", sans-serif;
  background: #f6f7fb;
  margin: 0;
  color: #333;
}

header {
  background: #cfd9ff;
  padding: 14px;
  text-align: center;
  font-weight: bold;
}

nav {
  display: flex;
}

nav button {
  flex: 1;
  padding: 10px;
  border: none;
  background: #e6ebff;
}

nav button.active {
  background: #fff;
  font-weight: bold;
}

main {
  padding: 14px;
  max-width: 480px;
  margin: auto;
}

section {
  background: #fff;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 14px;
}

h2 {
  font-size: 15px;
  margin: 0 0 8px 0;
}

input, select {
  width: 100%;
  padding: 8px;
  margin-bottom: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

select.placeholder {
  color: #999;
}

button.main {
  background: #d6e1ff;
  border: none;
  border-radius: 10px;
  padding: 10px;
  width: 100%;
  margin-bottom: 6px;
}

.task-btn {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin-bottom: 6px;
  background: #fff;
}

.task-btn.active {
  background: #cfd9ff;
}

.small {
  font-size: 12px;
  color: #666;
}

.hidden { display: none; }

.timer {
  font-size: 32px;
  text-align: center;
  margin: 10px 0;
}

.inline-btn {
  font-size: 12px;
  margin-left: 6px;
}
</style>
</head>

<body>

<header>今日のやること</header>

<nav>
  <button id="tabToday" class="active">今日のやること</button>
  <button id="tabManage">やること管理</button>
</nav>

<main>

<!-- 今日のやること -->
<div id="todayTab">
<section>
<h2>今日のやる気</h2>
<select id="mood">
  <option value="低">低</option>
  <option value="中">中</option>
  <option value="高">高</option>
</select>

<button class="main" id="recommendBtn">おすすめ</button>
<button class="main" id="randomBtn">ランダム</button>
</section>

<section>
<h2>やること提案（最大5件）</h2>
<div id="suggestions"></div>

<div class="small">おすすめ順一覧</div>
<div id="allList"></div>
</section>

<section>
<h2>タイマー</h2>

<select id="hour"></select>
<select id="minute"></select>

<div class="timer" id="timer">00:00</div>

<button class="main" id="startTimer">開始</button>
<button class="main" id="pauseTimer">一時停止</button>
<button class="main" id="stopTimer">終了</button>
</section>
</div>

<!-- 管理 -->
<div id="manageTab" class="hidden">

<section>
<h2>カテゴリ追加</h2>
<input id="newCategory" placeholder="カテゴリ名">
<button class="main" id="addCategory">追加</button>
</section>

<section>
<h2>やりたいこと追加</h2>
<select id="taskCategory" class="placeholder">
  <option value="">カテゴリ</option>
</select>
<input id="taskName" placeholder="やりたいこと">
<select id="taskType" class="placeholder">
  <option value="">能動/受動</option>
  <option value="能動">能動</option>
  <option value="受動">受動</option>
</select>
<button class="main" id="addTask">追加</button>
</section>

<section>
<h2>登録済み一覧</h2>
<div id="listArea"></div>
</section>

</div>
</main>

<audio id="alarm">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script>
let data = JSON.parse(localStorage.getItem("todayApp")||"{}");
if(!data.categories) data.categories={};

const save=()=>localStorage.setItem("todayApp",JSON.stringify(data));

const tabToday=document.getElementById("tabToday");
const tabManage=document.getElementById("tabManage");
const todayTab=document.getElementById("todayTab");
const manageTab=document.getElementById("manageTab");

tabToday.onclick=()=>switchTab(true);
tabManage.onclick=()=>switchTab(false);

function switchTab(t){
  todayTab.classList.toggle("hidden",!t);
  manageTab.classList.toggle("hidden",t);
  tabToday.classList.toggle("active",t);
  tabManage.classList.toggle("active",!t);
}

/* 管理 */
addCategory.onclick=()=>{
  const n=newCategory.value.trim();
  if(!n||data.categories[n])return;
  data.categories[n]=[];
  newCategory.value="";
  save();render();
};

addTask.onclick=()=>{
  const c=taskCategory.value;
  const n=taskName.value.trim();
  const t=taskType.value;
  if(!c||!n||!t)return;
  data.categories[c].push({name:n,type:t});
  taskName.value="";
  taskCategory.value="";
  taskType.value="";
  save();render();
};

function render(){
  taskCategory.innerHTML='<option value="">カテゴリ</option>';
  listArea.innerHTML="";
  let all=[];
  for(const c in data.categories){
    taskCategory.innerHTML+=`<option>${c}</option>`;

    const cd=document.createElement("div");
    cd.innerHTML=`<b>${c}</b>
      <button class="inline-btn" onclick="editCategory('${c}')">編集</button>
      <button class="inline-btn" onclick="deleteCategory('${c}')">削除</button>`;
    listArea.appendChild(cd);

    data.categories[c].forEach((t,i)=>{
      all.push(t);
      const td=document.createElement("div");
      td.innerHTML=`・${t.name}（${t.type}）
        <button class="inline-btn" onclick="editTask('${c}',${i})">編集</button>
        <button class="inline-btn" onclick="deleteTask('${c}',${i})">削除</button>`;
      listArea.appendChild(td);
    });
  }
  renderToday(all);
}

window.editCategory=(c)=>{
  const n=prompt("カテゴリ名変更",c);
  if(!n)return;
  data.categories[n]=data.categories[c];
  delete data.categories[c];
  save();render();
};

window.deleteCategory=(c)=>{
  if(!confirm("カテゴリを削除しますか？"))return;
  delete data.categories[c];
  save();render();
};

window.editTask=(c,i)=>{
  const t=data.categories[c][i];
  const n=prompt("名称変更",t.name);
  if(!n)return;
  t.name=n;
  save();render();
};

window.deleteTask=(c,i)=>{
  if(!confirm("削除しますか？"))return;
  data.categories[c].splice(i,1);
  save();render();
};

/* 今日 */
function renderToday(all){
  allList.innerHTML="";
  all.forEach(t=>{
    allList.innerHTML+=`<div class="small">・${t.name}（${t.type}）</div>`;
  });
}

recommendBtn.onclick=()=>pick(false);
randomBtn.onclick=()=>pick(true);

function pick(rand){
  suggestions.innerHTML="";
  let list=[];
  for(const c in data.categories){
    list=list.concat(data.categories[c]);
  }
  if(rand) list.sort(()=>Math.random()-0.5);
  list.slice(0,5).forEach(t=>{
    const b=document.createElement("button");
    b.className="task-btn";
    b.textContent=t.name;
    b.onclick=()=>b.classList.toggle("active");
    suggestions.appendChild(b);
  });
}

/* タイマー */
for(let i=0;i<24;i++)hour.innerHTML+=`<option>${i}</option>`;
for(let i=0;i<60;i++)minute.innerHTML+=`<option>${i}</option>`;

let sec=0,id;
startTimer.onclick=()=>{
  sec=hour.value*3600+minute.value*60;
  clearInterval(id);
  alarm.pause(); alarm.currentTime=0;
  id=setInterval(()=>{
    if(sec<=0){
      clearInterval(id);
      alarm.play();
      return;
    }
    sec--;
    timer.textContent=
      String(Math.floor(sec/60)).padStart(2,"0")+":"+
      String(sec%60).padStart(2,"0");
  },1000);
};

pauseTimer.onclick=()=>clearInterval(id);

stopTimer.onclick=()=>{
  clearInterval(id);
  alarm.pause();
  alarm.currentTime=0;
  timer.textContent="00:00";
};

render();
</script>
</body>
</html>
